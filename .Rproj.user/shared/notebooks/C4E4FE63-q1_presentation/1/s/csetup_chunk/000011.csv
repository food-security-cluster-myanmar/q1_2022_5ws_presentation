"0",""
"0","# replace "
"0","options(knitr.kable.NA = """")"
"0",""
"0","`%out%` <- Negate(`%in%`)"
"0",""
"0","# function for transposing df"
"0","transpose_df <- function(df) {"
"0","  t_df <- data.table::transpose(df)"
"0","  colnames(t_df) <- rownames(df)"
"0","  rownames(t_df) <- colnames(df)"
"0","  t_df <- t_df %>%"
"0","    tibble::rownames_to_column(.data = .) %>%"
"0","    tibble::as_tibble(.)"
"0","  return(t_df)"
"0","}"
"0",""
"0","# function beneficiary summaries"
"0","sum_ben <- function(df, column_var){"
"0","  "
"0","  column_var <- enquo(column_var)"
"0","  "
"0","  df %>%"
"0","    group_by(!!column_var) %>% # must add bang-bang"
"0","    summarise(beneficiaries = sum(new_beneficiaries, na.rm = TRUE)) %>% "
"0","    arrange(desc(beneficiaries))"
"0","    "
"0","}"
"0",""
"0","# function beneficiary summaries, 2 grouped variables"
"0","sum_ben2 <- function(df, column_var1, column_var2){"
"0","  "
"0","  column_var1 <- enquo(column_var1)"
"0","  column_var2 <- enquo(column_var2)"
"0","  "
"0","  df %>%"
"0","    group_by(!!column_var1, !!column_var2) %>% # must add bang-bang"
"0","    summarise(beneficiaries = sum(new_beneficiaries, na.rm = TRUE), .groups = ""drop"")"
"0","    "
"0","}"
"0",""
"0","# scaling functions "
"0","range01 <- function(x){(x-min(x))/(max(x)-min(x))}"
"0","range_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}"
"0",""
"0","#mode function "
"0","mode <- function(x) {"
"0","  ux <- unique(x)"
"0","  ux[which.max(tabulate(match(x, ux)))]"
"0","}"
"0",""
"0","pcode4 <- read_excel(""2022_FSCMYA_5W_template.xlsx"", "
"0","           sheet = ""GEOADMINS"") %>% "
"0","  clean_names() %>% "
"0","  select(admin1pcode_9:admin1_3) %>% "
"0","  rename(admin1_pcode = admin1pcode_9,"
"0","         state = state_10, "
"0","         township = township_11,"
"0","         admin3_pcode = admin3pcode_12, "
"0","         vt_town = vt_and_town_13, "
"0","         admin4_pcode = vt_and_town_pcode_14)"
"2","New names:
* State -> State...1
* Admin1PCODE -> Admin1PCODE...2
* `` -> ...3
* Admin1PCODE -> Admin1PCODE...4
* State -> State...5
* ...
"
"0"," "
"0","villages <- read_excel(""2022_FSCMYA_5W_template.xlsx"", "
"0","           sheet = ""GEOADMINS"") %>% "
"0","  clean_names() %>%"
"0","  select(admin1pcode_17:location_type) %>% "
"0","  rename(admin1_pcode = admin1pcode_17,"
"0","         state = state_18, "
"0","         township = township_19,"
"0","         admin3_pcode = admin3pcode_20, "
"0","         vt_town = vt_and_town_21, "
"0","         admin4_pcode = vt_and_town_pcode_22)"
"2","New names:
* State -> State...1
* Admin1PCODE -> Admin1PCODE...2
* `` -> ...3
* Admin1PCODE -> Admin1PCODE...4
* State -> State...5
* ...
"
"0","camps <- read_excel(""2022_FSCMYA_5W_template.xlsx"", "
"0","           sheet = ""GEOADMINS"") %>% "
"0","  clean_names() %>%"
"0","  select(township = township_29, camp_name, pcode_camp = p_code_camp)"
"2","New names:
* State -> State...1
* Admin1PCODE -> Admin1PCODE...2
* `` -> ...3
* Admin1PCODE -> Admin1PCODE...4
* State -> State...5
* ...
"
"0","industrial_zones <- read_excel(""2022_FSCMYA_5W_template.xlsx"", "
"0","           sheet = ""GEOADMINS"") %>% "
"0","  clean_names() %>% "
"0","  select(state = state_36, admin1_pcode = admin1pcode_37, industrial_zone = industrial_zones)"
"2","New names:
* State -> State...1
* Admin1PCODE -> Admin1PCODE...2
* `` -> ...3
* Admin1PCODE -> Admin1PCODE...4
* State -> State...5
* ...
"
"0","fsc <- read_csv(""fsc_codes.csv"") %>% "
"0","  rename_all(~str_replace_all(., ""^number_of_"", """")) %>%"
"0","  rename_all(~str_replace_all(., ""^number_"", """")) %>%"
"0","  rename(specify_location = specify_location_if_the_the_location_is_not_in_the_list) %>% "
"0","  mutate(idp_camp_site_name= as.character(idp_camp_site_name)) %>% "
"0","  mutate(location = case_when(!is.na(idp_camp_site_name) ~ idp_camp_site_name,"
"0","                              !is.na(village_ward) ~ village_ward,"
"0","                              !is.na(specify_location) ~ specify_location,"
"0","                              !is.na(village_tract_town) ~ village_tract_town)) %>%"
"0","  mutate(date = my(month_of_implementation)) %>% "
"0","  rename(activity = fsc_main_activity) %>% "
"0","  mutate(township = recode(township, ""Putao"" = ""Puta-O""), "
"0","         admin3_pcode = ifelse(township == ""Puta-O"", ""MMR001014"", admin3_pcode)) %>% "
"0","  left_join(pcode4 %>% select(township, vt_town, admin3_pcode, admin4_pcode, admin1_pcode), by = "
"0","              c(""village_tract_town"" = ""vt_town"", ""township"" = ""township"", "
"0","                ""admin3_pcode"" = ""admin3_pcode"", ""admin1_pcode"" = ""admin1_pcode"")) %>% "
"0","  mutate(total_value_usd = case_when(currency == ""MMK"" ~ total_value / 1776, "
"0","                                     currency == ""USD"" ~ total_value)) %>% "
"0","  rename(state = state_region) %>% "
"0","  mutate(admin3_pcode_old = case_when(admin3_pcode %in% c(""MMR013046"", ""MMR013047"") ~ ""MMR013008"", "
"0","                                  admin3_pcode == ""MMR015202"" ~ ""MMR015022"","
"0","                                  admin3_pcode == ""MMR015315"" ~ ""MMR015010"", "
"0","                                  admin3_pcode == ""MMR015312"" ~ ""MMR015006"",	"
"0","                                  admin3_pcode == ""MMR015308"" ~ ""MMR015007"","
"0","                                  admin3_pcode == ""MMR016321"" ~ ""MMR016003"", "
"0","                                  TRUE ~ admin3_pcode)) %>% "
"0","  # removing a duplicate entry from the left join "
"0","  mutate(drop = case_when(admin4_pcode == ""MMR007008058"" ~ 1, TRUE ~ 0)) %>% "
"0","  rename(response_plan = response_plan_if_project_under_fts, "
"0","         beneficiaries = reached_beneficiaries, "
"0","         households = reached_households) %>% "
"0","  filter(drop != 1) %>% select(-drop) %>% "
"0","  replace_na(list(new_beneficiaries = 0)) %>% "
"0","  mutate(activity_red = case_when(activity %in% c(""food distributions (in kind/voucher/cash), moderate"", "
"0","                                                  ""food distributions (in kind/voucher/cash), severe"") ~ "
"0","                                    ""food distribution"","
"0","                                  activity %in% c(""multi-purpose cash transfer (MPC), moderate"","
"0","                                                  ""multi-purpose cash transfer (MPC), severe"") ~ "
"0","                                    ""multi-purpose cash transfer"","
"0","                                  activity == ""livelihoods vocational training"" ~ ""vocational training"","
"0","                                  activity == ""food/cash for work/assets"" ~ ""food_cash for work_assets"","
"0","                                  activity == ""income-generating activities and small grants"" ~ ""IGA and small grants"", "
"0","                                  TRUE ~ activity), "
"0","         activity_red = str_remove_all(activity_red, ""provision of "")) %>%"
"0","  mutate(strat_obj = case_when(activity_red %in% c(""food distribution"", ""multi-purpose cash transfer"") &"
"0","                                 beneficiary_type == ""Internally Displaced"" ~ "
"0","                          ""so_1"", "
"0","                        activity_red %in% c(""food distribution"", ""multi-purpose cash transfer"") & "
"0","                          beneficiary_type != ""Internally Displaced"" ~ "
"0","                          ""so_2"", "
"0","                        TRUE ~ ""so_3"")) %>% "
"0","   # these partners did not provide the numbers of households"
"0","  mutate(households = ifelse(is.na(households), beneficiaries, households)) %>% "
"0","  mutate(usd_per_hhd = total_value_usd / households, "
"0","         usd_per_person = total_value_usd / beneficiaries) %>% "
"0","  mutate(usd_hhd_bin = case_when(usd_per_hhd < 10 ~ ""<$10"","
"0","                     usd_per_hhd >= 10 & usd_per_hhd < 20 ~ "">=$10_<$20"","
"0","                     usd_per_hhd >= 20 & usd_per_hhd < 30 ~ "">=$20_<$30"","
"0","                     usd_per_hhd >= 30 & usd_per_hhd < 40 ~ "">=$30_<$40"","
"0","                     usd_per_hhd >= 40 & usd_per_hhd < 50 ~ "">=$40_<$50"","
"0","                     usd_per_hhd >= 50 & usd_per_hhd < 60 ~ "">=$50_<$60"","
"0","                     usd_per_hhd >= 60 & usd_per_hhd < 70 ~ "">=$60_<$70"","
"0","                     usd_per_hhd >= 70 & usd_per_hhd < 80 ~ "">=$70_<$80"","
"0","                     usd_per_hhd >= 80 & usd_per_hhd < 90 ~ "">=$80_<$90"","
"0","                     usd_per_hhd >= 90 & usd_per_hhd < 100 ~ "">=$90_<$100"","
"0","                     usd_per_hhd >= 100 ~ "">=$100"","
"0","                     TRUE ~ NA_character_),"
"0","         usd_hhd_bin = fct_relevel(usd_hhd_bin, c(""<$10"", "">=$10_<$20"", "">=$20_<$30"", "">=$30_<$40"", "">=$40_<$50"","">=$50_<$60"", "
"0","                                                  "">=$60_<$70"", "">=$70_<$80"", "">=$80_<$90"","">=$90_<$100"","">=$100""))) %>% "
"0","  mutate(usd_person_bin = case_when(usd_per_person < 2 ~ ""<$2"","
"0","                                 usd_per_person >= 2 & usd_per_person < 4 ~ "">=$2_<$4"","
"0","                                 usd_per_person >= 4 & usd_per_person < 6 ~ "">=$4_<$6"","
"0","                                 usd_per_person >= 6 & usd_per_person < 8 ~ "">=$6_<$8"","
"0","                                 usd_per_person >= 8 & usd_per_person < 10 ~ "">=$8_<$10"","
"0","                                 usd_per_person >= 10 & usd_per_person < 12 ~ "">=$10_<$12"","
"0","                                 usd_per_person >= 12 & usd_per_person < 14 ~ "">=$12_<$14"","
"0","                                 usd_per_person >= 14 & usd_per_person < 16 ~ "">=$14_<$16"","
"0","                                 usd_per_person >= 16 & usd_per_person < 18 ~ "">=$16_<$18"","
"0","                                 usd_per_person >= 18 & usd_per_person < 20 ~ "">=$18_<$20"","
"0","                                 usd_per_person >= 20 ~ "">=$20"","
"0","                     TRUE ~ NA_character_), "
"0","         usd_person_bin = fct_relevel(usd_person_bin, c(""<$2"", "">=$2_<$4"", "">=$4_<$6"", "">=$6_<$8"", "">=$8_<$10"","">=$10_<$12"", "
"0","                                                  "">=$12_<$14"", "">=$14_<$16"", "">=$16_<$18"", "">=$18_<$20"","">=20""))) %>% "
"0","  mutate(location_type = recode(location_type, ""village"" = ""Village""))"
"2","[1mRows: [22m[34m2116[39m [1mColumns: [22m[34m60[39m
"
"2","[36m--[39m [1mColumn specification[22m [36m-----------------------------------------------------------------------------------------------------------------------[39m
[1mDelimiter:[22m "",""
[31mchr[39m (42): month_of_implementation, donor, reporting_organization_type, implementing_partner_type, state_region, township, village_tract_tow...
[32mdbl[39m (17): quantity, total_value, value_per_household, value_per_individual, value_per_household_usd, number_child_male, number_child_female...
[33mlgl[39m  (1): admin2_pcode
"
"2","
[36mi[39m Use [38;5;235m[48;5;253m[38;5;235m[48;5;253m`spec()`[48;5;253m[38;5;235m[49m[39m to retrieve the full column specification for this data.
[36mi[39m Specify the column types or set [38;5;235m[48;5;253m[38;5;235m[48;5;253m`show_col_types = FALSE`[48;5;253m[38;5;235m[49m[39m to quiet this message.
"
"2","Warning: Unknown levels in `f`: >=20"
"0"," "
"0","  "
"0","pin <- read_csv(""fs_pin.csv"") %>% "
"0","  select(-admin1_pcode) %>% "
"0","  left_join(pcode4 %>% distinct(admin1_pcode, state), by = ""state"")"
"2","[1mRows: [22m[34m330[39m [1mColumns: [22m[34m30[39m
"
"2","[36m--[39m [1mColumn specification[22m [36m-----------------------------------------------------------------------------------------------------------------------[39m
[1mDelimiter:[22m "",""
[31mchr[39m  (6): state, admin1_pcode, district, township, admin3_pcode, group
[32mdbl[39m (24): population_2021_proj, fs_pin, fs_targeted, battles, explosions_remote_violence, protests_and_riots, strategic_developments, viole...
"
"2","
[36mi[39m Use [38;5;235m[48;5;253m[38;5;235m[48;5;253m`spec()`[48;5;253m[38;5;235m[49m[39m to retrieve the full column specification for this data.
[36mi[39m Specify the column types or set [38;5;235m[48;5;253m[38;5;235m[48;5;253m`show_col_types = FALSE`[48;5;253m[38;5;235m[49m[39m to quiet this message.
"
"0","fsc_2021 <- read_csv(""fsc5w_2021.csv"") %>%"
"0","  mutate(activity_new = "
"0","           case_when(str_detect(activity_description, ""Local Chicken support"") ~"
"0","                       ""provision of livestock kits"","
"0","                     activity == ""Cash for Work / Food for Assets"" ~"
"0","                       ""food/cash for work/assets"","
"0","                     str_detect(activity_description, ""home|Home"") & "
"0","                       !str_detect(activity_description, ""training|Training|Training,"") ~"
"0","                       ""provision of kitchen garden kits"","
"0","                     activity == ""Provide crops & vegetables kits"" & "
"0","                       str_detect(activity_description, ""pumps|till|drum|Tiller|Drum"") ~ "
"0","                       ""provision of community infrastructure and equipment"","
"0","                     activity == ""Provide crops & vegetables kits"" ~ "
"0","                       ""provision of crop, vegetable and seed kits"","
"0","                     activity == ""Provide fishery kits"" ~ "
"0","                       ""provision of fishery kits"","
"0","                     activity == ""Provide livestock kits"" ~ "
"0","                       ""provision of livestock kits"","
"0","                     activity %in% c(""Provide monthly cash-based transfers"", ""Provide monthly food baskets"") & "
"0","                       str_detect(activity_description, ""Lifesaving|lifesaving|acute|Acute"") ~ "
"0","                       ""food distributions (in kind/voucher/cash), severe"","
"0","                     # what to do about MVC, malnourished children and PLW?"
"0","                     activity %in% c(""Provide monthly cash-based transfers"", ""Provide monthly food baskets"")  ~"
"0","                       ""food distributions (in kind/voucher/cash), moderate"",  "
"0","                     activity == ""Provide support for income generation"" & "
"0","                       !str_detect(activity_description, ""agriculture input|farming"") ~"
"0","                       ""income-generating activities and small grants"","
"0","                     activity  == ""Provide support for income generation""  ~"
"0","                       ""income-generating activities and small grants"","
"0","                     activity == ""Provide technical training"" & str_detect(activity_description,"
"0","                                               ""farm|Farm|FFS|pesticide|ferti|agri|Agri|gardening|Seed|seed|SSA"") ~"
"0","                       ""FFS and farmer training"","
"0","                     activity == ""Provide technical training"" ~ ""vocational training"","
"0","                     activity_description %in% c(""Provide Voucher Cards to buy agriculture inputs for their agricultural works"","
"0","                                                 ""Cash for farming (Livestock and Agri)"") ~"
"0","                       ""provision of crop, vegetable and seed kits"", "
"0","                     TRUE ~ NA_character_)) %>% "
"0","   mutate(activity_red = case_when(activity_new %in% c(""food distributions (in kind/voucher/cash), moderate"","
"0","                                                   ""food distributions (in kind/voucher/cash), severe"") ~"
"0","                                     ""food distribution"","
"0","                                  activity_new %in% c(""multi-purpose cash transfer (MPC), moderate"","
"0","                                                  ""multi-purpose cash transfer (MPC), severe"") ~ "
"0","                                    ""multi-purpose cash transfer"","
"0","                                  activity == ""livelihoods vocational training"" ~ ""vocational training"","
"0","                                  activity == ""food/cash for work/assets"" ~ ""food_cash for work_assets"","
"0","                                  activity == ""income-generating activities and small grants"" ~ ""IGA and small grants"","
"0","                                  TRUE ~ activity_new)) %>% "
"0","  mutate(strat_obj = case_when(activity_red %in% c(""food distribution"", ""multi-purpose cash transfer"") & "
"0","                          beneficiary_type == ""Internally Displaced"" ~ "
"0","                          ""so_1"", "
"0","                        activity_red %in% c(""food distribution"", ""multi-purpose cash transfer"") & "
"0","                          beneficiary_type != ""Internally Displaced"" ~ "
"0","                          ""so_2"", "
"0","                        TRUE ~ ""so_3"")) %>% "
"0","  mutate(activity_red = recode(activity_red, "
"0","                                       ""food/cash for work/assets"" = ""food_cash for work_assets"", "
"0","                                       ""provision of crop, vegetable and seed kits"" = ""crop, vegetable and seed kits"","
"0","                                       ""provision of livestock kits"" = ""livestock kits"","
"0","                                       ""income-generating activities and small grants"" = ""IGA and small grants""), "
"0","         activity_red = str_remove_all(activity_red, ""provision of ""))"
"2","[1mRows: [22m[34m16041[39m [1mColumns: [22m[34m72[39m
"
"2","[36m--[39m [1mColumn specification[22m [36m-----------------------------------------------------------------------------------------------------------------------[39m
[1mDelimiter:[22m "",""
[31mchr[39m  (46): month_of_implementation, donor, reporting_organization_type, implementing_partner_type, state, township, village_ward_town, camp...
[32mdbl[39m  (25): quantity_for_in_kind_assistance, value_per_household, value_per_household_usd, total_value_usd, total_value_mmk, child_male, chi...
[34mdate[39m  (1): date
"
"2","
[36mi[39m Use [38;5;235m[48;5;253m[38;5;235m[48;5;253m`spec()`[48;5;253m[38;5;235m[49m[39m to retrieve the full column specification for this data.
[36mi[39m Specify the column types or set [38;5;235m[48;5;253m[38;5;235m[48;5;253m`show_col_types = FALSE`[48;5;253m[38;5;235m[49m[39m to quiet this message.
"
"0","# shapefiles"
"0","pcode3_shape <- st_read(""./mmr_polbnda_adm3_mimu_250k/mmr_polbnda_adm3_mimu_250k.shp"", quiet = TRUE) %>%"
"0","  rename(state = ST, "
"0","        admin1_pcode = ST_PCODE,"
"0","        township = TS,"
"0","        admin3_pcode = TS_PCODE) %>% "
"0"," mutate(admin3_pcode = ifelse(str_detect(township, ""Hlaingtharya""), ""MMR013008"", admin3_pcode))"
"0",""
"0","pcode1_shape <- st_read(""./mmr_polbnda2_adm1_mimu_250k/mmr_polbnda2_adm1_mimu_250k.shp"", quiet = TRUE) %>% "
"0"," rename(state = ST, "
"0","        admin1_pcode = ST_PCODE) %>% st_as_sf()"
